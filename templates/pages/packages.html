{% extends 'base.html' %}
{% load static %}

{% block title %}Relief Packages - Greatness Community Relief{% endblock %}

{% block extra_css %}
{% endblock %}

{% block content %}
<!-- Page Header -->
<section class="bg-light py-5">
    <div class="container">
        <div class="row justify-content-center text-center">
            <div class="col-lg-8">
                <h1 class="display-4 fw-bold text-gradient mb-3">Relief Packages</h1>
                <p class="lead text-muted">
                    Browse our comprehensive collection of relief packages designed to support families in need. 
                    Each package combines essential food items with financial assistance.
                </p>
            </div>
        </div>
    </div>
</section>

<!-- Filter Section -->
<section class="py-4 bg-white shadow-sm">
    <div class="container">
        <form class="filter-form">
            <div class="row g-3 align-items-center">
                <div class="col-lg-4 col-md-6">
                    <div class="input-group">
                        <span class="input-group-text">
                            <i class="bi bi-search"></i>
                        </span>
                        <input type="search" name="search" class="form-control" placeholder="Search packages...">
                    </div>
                </div>
                <div class="col-lg-2 col-md-6">
                    <select name="family_size" class="form-select">
                        <option value="all">All Sizes</option>
                        <option value="small">Small (1-3)</option>
                        <option value="medium">Medium (4-6)</option>
                        <option value="large">Large (7+)</option>
                    </select>
                </div>
                <div class="col-lg-2 col-md-6">
                    <select name="availability" class="form-select">
                        <option value="all">All Status</option>
                        <option value="available">Available</option>
                        <option value="limited">Limited</option>
                        <option value="unavailable">Unavailable</option>
                    </select>
                </div>
                <div class="col-lg-2 col-md-6">
                    <select name="sort" class="form-select">
                        <option value="name">Sort by Name</option>
                        <option value="price">Sort by Price</option>
                        <option value="family_size">Sort by Family Size</option>
                    </select>
                </div>
                <div class="col-lg-2 col-md-12">
                    <button type="button" class="btn btn-outline-secondary w-100" onclick="resetFilters()">
                        <i class="bi bi-arrow-counterclockwise me-1"></i>Reset
                    </button>
                </div>
            </div>
        </form>
    </div>
</section>

<!-- Packages Grid -->
<section class="py-5">
    <div class="container">
        <div class="packages-container">
            <div class="row g-4">
                {% for package in packages %}
                <div class="col-lg-4 col-md-6">
                    <div class="package-card card h-100" data-family-size="{{ package.family_size_category }}" data-available="{% if package.is_available %}true{% else %}false{% endif %}">
                        <div class="stock-badge">
                            <span class="badge {{ package.stock_badge_class }}">{{ package.stock_badge_text }}</span>
                        </div>
                        <div class="card-header text-center{% if package.card_header_class %} {{ package.card_header_class }}{% endif %}">
                            <h5 class="card-title mb-0">{{ package.name }}</h5>
                            <small{% if not package.card_header_class %} class="text-warning"{% endif %}>{{ package.family_size_text }}</small>
                        </div>
                        <div class="card-body">
                            <div class="text-center mb-3">
                                <span class="price-tag">₦{{ package.cash_amount|floatformat:0 }}</span>
                                <small class="text-muted d-block">Cash + Food Items</small>
                            </div>
                            
                            <div class="package-items">
                                {% for item_key, item_value in package.items_included.items %}
                                <div class="item">
                                    <i class="bi bi-check-circle-fill"></i>
                                    <span>{{ item_value|title }}</span>
                                </div>
                                {% endfor %}
                                <div class="item">
                                    <i class="bi bi-check-circle-fill"></i>
                                    <span>Cash: ₦{{ package.cash_amount|floatformat:0 }}</span>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <small class="{% if package.package_type == 'emergency' %}text-warning{% elif package.package_type == 'senior' %}text-success{% else %}text-muted{% endif %}">
                                    <i class="{{ package.duration_icon }} me-1"></i>{{ package.duration_text }}
                                </small>
                            </div>
                            
                            {% if package.is_available %}
                                {% if package.package_type == 'emergency' %}
                                    <a href="{% url 'apply' %}" class="btn btn-danger w-100">Apply for Emergency Relief</a>
                                {% elif package.package_type == 'senior' %}
                                    <a href="{% url 'apply' %}" class="btn btn-success w-100">Apply for Package</a>
                                {% else %}
                                    <a href="{% url 'apply' %}" class="btn btn-primary w-100">Apply for Package</a>
                                {% endif %}
                            {% else %}
                                <button class="btn btn-secondary w-100" disabled>Currently Unavailable</button>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="col-12">
                    <div class="text-center py-5">
                        <i class="bi bi-gift display-4 text-muted mb-3"></i>
                        <h4 class="text-muted">No packages available</h4>
                        <p class="text-muted">Please check back later for available relief packages.</p>
                    </div>
                </div>
                {% endfor %}

            </div>
        </div>
    </div>
</section>

<!-- Help Section -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8 text-center">
                <h3 class="fw-bold mb-4">Need Help Choosing?</h3>
                <p class="text-muted mb-4">
                    Our care team is here to help you find the right package for your family's needs. 
                    Contact us for personalized assistance.
                </p>
                <div class="d-flex flex-wrap justify-content-center gap-3">
                    {% if contact_phone %}
                    <a href="tel:{{ contact_phone }}" class="btn btn-primary">
                        <i class="bi bi-telephone me-2"></i>Call Us
                    </a>
                    {% endif %}
                    {% if contact_email %}
                    <a href="mailto:{{ contact_email }}" class="btn btn-outline-primary">
                        <i class="bi bi-envelope me-2"></i>Email Support
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
function resetFilters() {
    document.querySelector('.filter-form').reset();
    // Trigger filter application
    if (window.CommunityRelief && window.CommunityRelief.PackageFilter) {
        const filter = new window.CommunityRelief.PackageFilter();
        if (filter.applyFilters) {
            filter.applyFilters();
        }
    }
}
</script>
{% endblock %}